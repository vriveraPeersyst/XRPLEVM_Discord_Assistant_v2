
# XRPL-EVM Discord Assistant

> A Discord bot powered by OpenAI Assistants & Vector Stores, providing on-chain and developer documentation lookup for XRPL-EVM, Cosmos, Evmos, and related ecosystems.

---

## Table of Contents

1. [Overview](#overview)  
2. [Features](#features)  
3. [Architecture & Workflow](#architecture--workflow)  
4. [Repository Structure](#repository-structure)  
5. [Getting Started](#getting-started)  
   - [Prerequisites](#prerequisites)  
   - [Installation](#installation)  
   - [Configuration](#configuration)  
6. [Environment Variables](#environment-variables)  
7. [Usage](#usage)  
   - [Stateless Commands](#stateless-commands)  
   - [Threaded Conversations](#threaded-conversations)  
   - [Slash Commands (BullManager)](#slash-commands-bullmanager)  
8. [Documentation Ingestion & Vector Store](#documentation-ingestion--vector-store)  
   - [Repos Config](#repos-config)  
   - [Markdown ‚Üí Text Conversion](#markdown--text-conversion)  
   - [ManualFolder Assets](#manualfolder-assets)  
   - [Uploading & Vectorization](#uploading--vectorization)  
9. [Daily Auto-Update & Logging](#daily-auto-update--logging)  
10. [Scheduled Content Jobs](#scheduled-content-jobs)  
11. [Development](#development)  
12. [Contributing](#contributing)  
13. [License](#license)  

---

## Overview

The **XRPL-EVM Discord Assistant** is a powerful, context-aware helper designed for XRPL-EVM and related blockchain ecosystems. It:

- **Ingests** on-chain documentation from multiple GitHub repos  
- **Converts** Markdown, PDFs, images, and CSVs into plain text  
- **Uploads** text assets into an OpenAI vector store for high-fidelity retrieval  
- **Runs** a custom OpenAI Assistant (gpt-4o-mini) with file‚Äêsearch tools  
- **Integrates** tightly with Discord for stateless queries, threaded conversations, slash commands, and scheduled pushes  

---

## Features

- üîç **Contextual Q&A** against XRPL-EVM, XRPL Core, Cosmos SDK, Evmos docs  
- üìÑ **Auto-conversion** of Markdown, PDF, image, and CSV docs to text  
- üåê **Vector store** creation & daily refresh  
- üóìÔ∏è **Scheduled content** pushes via slash commands (`/bullmanager`)  
- üìù **Threaded** multi-message dialogues with full history  
- üõ†Ô∏è **Admin logging** of daily doc refreshes to a dedicated channel  

---

## Architecture & Workflow

1. **DocsUpdater**  
   - Clones/pulls each GitHub repo from `repos.config.json`  
   - Converts `.md` ‚Üí `.txt` via `convertAllMdToTxt()`  
2. **ManualFolder Ingestion**  
   - OCR/PDF/text extraction via `convertNonTextToTxt()`  
3. **Vector Store**  
   - Uploads every `.txt` to OpenAI Files API  
   - Creates a new vector store daily  
   - Adds all file IDs to the store  
4. **Assistant Deployment**  
   - Calls OpenAI Assistants API with vector store ID  
   - Persists Assistant ID in `vectorStoreId.txt`  
5. **Discord Integration**  
   - **Stateless**: `!askbull <query>` ‚Üí immediate answer  
   - **Threads**: `!askbullthread <query>` ‚Üí creates/continues a thread  
   - **Slash Commands**: `/bullmanager` ‚Üí manage updates & schedules  
   - **Scheduled Jobs**: cron jobs to push content to channels  
6. **Daily Cron**  
   - Runs at **02:00 UTC** every day  
   - Sends a log (success/failure) to the configured admin channel  
   - Automatically updates vector store and assistant  

---

## Repository Structure

```

.
‚îú‚îÄ‚îÄ .env.example                  # Sample environment variables
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ ManualFolder/
‚îÇ   ‚îî‚îÄ‚îÄ xrplevmManualDocs/
‚îÇ       ‚îî‚îÄ‚îÄ xrplevm-dapps-explorer-apps.txt
‚îú‚îÄ‚îÄ README.md                     # ‚Üê you are here
‚îú‚îÄ‚îÄ backup\_and\_export.sh          # Generates repo report (for audits)
‚îú‚îÄ‚îÄ eng.traineddata               # Tesseract language data
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ repo\_report.txt               # Generated by backup script
‚îú‚îÄ‚îÄ repos.config.json             # List of doc repos to clone
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ vectorStoreId.txt             # Persisted vector store ID
‚îî‚îÄ‚îÄ src/
‚îú‚îÄ‚îÄ assistantClient.ts        # OpenAI Files & Assistants API wrappers
‚îú‚îÄ‚îÄ assistantGlobals.ts       # In-memory Assistant ID store
‚îú‚îÄ‚îÄ assistantManager.ts       # Interactive slash-command schedulers
‚îú‚îÄ‚îÄ assistantRunner.ts        # Helper for sending replies
‚îú‚îÄ‚îÄ cliUtils.ts               # Simple Y/N prompt (no longer used)
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ bullManager.ts        # Slash‚Äêcommand definitions
‚îÇ   ‚îî‚îÄ‚îÄ deploy-commands.ts    # Registers slash commands with Discord
‚îú‚îÄ‚îÄ convertNonTextToTxt.ts    # PDF/image/CSV ‚Üí text extractor
‚îú‚îÄ‚îÄ docsUpdater.ts            # Git clone/pull & markdown converter
‚îú‚îÄ‚îÄ fileProcessor.ts          # Legacy non-text converter & gatherer
‚îú‚îÄ‚îÄ index.ts                  # Bot entrypoint, all setup & handlers
‚îú‚îÄ‚îÄ messageProcessor.ts       # Processes content + attachments
‚îú‚îÄ‚îÄ scheduler.ts              # Scheduled content job registry
‚îî‚îÄ‚îÄ threadHandler.ts          # Thread‚Äêbased conversation logic

````

---

## Getting Started

### Prerequisites

- **Node.js** ‚â• 18  
- **npm** or **yarn**  
- **Discord Bot** application & token  
- **OpenAI** API key & Assistants beta access  

### Installation

1. **Clone** this repo:
   ```bash
   git clone https://github.com/vriveraPeersyst/XRPLEVM_Discord_Assistant_v2.git
   cd XRPLEVM_Discord_Assistant_v2
````

2. **Install** dependencies:

   ```bash
   npm install
   # or
   yarn install
   ```
3. **Build** TypeScript (optional):

   ```bash
   tsc
   ```

### Configuration

1. **Copy** `.env.example` ‚Üí `.env` and fill in:

   ```env
   DISCORD_BOT_TOKEN=your_discord_bot_token
   CLIENT_ID=your_discord_app_client_id
   GUILD_ID=your_guild_id_if_using_guild_commands
   OPENAI_API_KEY=sk-...
   ASSISTANT_API_BASE=https://api.openai.com/v1/assistants
   ASSISTANT_FILES_API_BASE=https://api.openai.com/v1/files
   ADMIN_CHANNEL_ID=123456789012345678   # Channel for daily logs
   ```
2. **Edit** `repos.config.json` to include any additional documentation GitHub URLs.

---

## Environment Variables

| Variable                   | Description                                                                  |
| -------------------------- | ---------------------------------------------------------------------------- |
| `DISCORD_BOT_TOKEN`        | Bot token from Discord Developer Portal                                      |
| `CLIENT_ID`                | Application (bot) client ID                                                  |
| `GUILD_ID`                 | (Optional) guild ID for guild-scoped slash commands                          |
| `OPENAI_API_KEY`           | Your OpenAI API key                                                          |
| `ASSISTANT_API_BASE`       | Base URL for Assistants API (usually `https://api.openai.com/v1/assistants`) |
| `ASSISTANT_FILES_API_BASE` | Base URL for Files API (`https://api.openai.com/v1/files`)                   |
| `ADMIN_CHANNEL_ID`         | Discord channel ID to receive daily update logs                              |

---

## Usage

### Stateless Commands

* **Ask a question:**

  ```txt
  !askbull How do I deploy an XRPL-EVM smart contract?
  ```
* The bot replies directly; if the answer is >1900 characters, it‚Äôs attached as `response.txt`.

### Threaded Conversations

* **Start a threaded Q\&A:**

  ```txt
  !askbullthread How do I query account info?
  ```
* The bot creates (or continues) a Discord thread for multi-turn dialogue.

### Slash Commands (BullManager)

Use `/bullmanager` with subcommands:

* **/bullmanager update**
  Manually trigger docs re-upload & assistant rebuild.

* **/bullmanager list**
  List all scheduled content jobs (titles, IDs, cron expressions).

* **/bullmanager add**
  Interactive modal to schedule new daily/recurring pushes.

* **/bullmanager toggle**
  Pause/resume a job by ID.

---

## Documentation Ingestion & Vector Store

1. **Repos Config** (`repos.config.json`):

   ```json
   {
     "repos": [
       { "name": "xrplevm-docs", "url": "https://github.com/ripple/docs.xrplevm.org.git" },
       { "name": "xrpl-docs",    "url": "https://github.com/XRPLF/xrpl-dev-portal.git" },
       { "name": "cosmos-docs",  "url": "https://github.com/cosmos/cosmos-sdk.git" },
       { "name": "evmos-docs",   "url": "https://github.com/evmos/docs.git" }
     ]
   }
   ```

2. **Markdown ‚Üí Text Conversion**

   * `docsUpdater.ts` clones/pulls each repo into a temp folder.\*
   * `convertAllMdToTxt()` finds every `.md` and writes a `.txt` next to it.

3. **ManualFolder Assets**

   * `convertNonTextToTxt.ts` recursively OCR‚Äôs PDFs/images, reads CSVs, outputs `.txt`.

4. **Uploading & Vectorization**

   * `assistantClient.uploadFile()` ‚Üí OpenAI Files API
   * `createVectorStore()` ‚Üí new empty store
   * `addFileToVectorStore()` for each file ID
   * Persist `vectorStoreId.txt`

5. **Assistant Update**

   * `createOrUpdateAssistantWithVectorStore()` binds the new store to your assistant
   * Assistant is ready to handle file-search queries

---

## Daily Auto-Update & Logging

* A **cron** job runs at **02:00 UTC** every day.
* It invokes `updateAssistantDocs()`, rebuilding the vector store and assistant.
* On **success**, posts a summary to `ADMIN_CHANNEL_ID`:

  ```
  ‚úÖ Daily docs update succeeded.
  ‚Ä¢ Files uploaded: 42
  ‚Ä¢ Vector Store ID: vs_abc123
  ‚Ä¢ Assistant ID: asst_xyz789
  ```
* On **failure**, posts a detailed error message.

---

## Scheduled Content Jobs

Use `/bullmanager add` to open a modal and configure:

* **Title** (arbitrary descriptor)
* **Repeat Interval** (e.g. ‚Äú3 minutes‚Äù, ‚Äú1 day‚Äù) ‚Üí translated to cron
* **Start Time** (UTC+1 date/time) ‚Üí converted to UTC ISO
* **Prompt** (the assistant question)
* **General Info** (context or metadata)

Jobs are stored in `scheduledContent.json` and executed via `node-cron`. Each job:

* Builds a one-message conversation
* Sends the assistant reply to the specified channel

Use `/bullmanager list` & `/bullmanager toggle <id>` to manage them.

---

## Development

* **Run locally**:

  ```bash
  npm run start
  ```
* **Linting & formatting**: integrate your preferred tools (ESLint, Prettier).
* **Testing**: no tests defined‚Äîfeel free to add unit/integration suites.

---

## Contributing

1. Fork the repo
2. Create a feature branch (`git checkout -b feat/your-feature`)
3. Commit your changes (`git commit -m "feat: add ‚Ä¶"`)
4. Push to your fork (`git push origin feat/your-feature`)
5. Open a Pull Request describing your changes

Please follow the [Conventional Commits](https://www.conventionalcommits.org/) guideline.

---

## License

This project is licensed under the **ISC License**. See [LICENSE](./LICENSE) for details.

---

*Happy building on XRPL-EVM!*
